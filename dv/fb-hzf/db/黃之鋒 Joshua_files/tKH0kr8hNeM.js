/*!CK:801880593!*//*1410947955,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["2JYhH"]); }

__d("Typeahead",["setTimeoutAcrossTransitions","CSS","DOM","MTouchHelper","MViewport","Vector","copyProperties","createDeprecatedProperties","eventsMixinDeprecated"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(q,r){"use strict";this._hardpoint=q;this._control=r||i.find(q,'input');this._root=i.create('div',{className:'jx-typeahead-results',sigil:'jx-typeahead-results'});this._display=[];this._listener=i.listen(this._control,['focus','blur','keypress','keydown','input'],null,this.handleEvent.bind(this));i.listen(this._root,[j.EVT_TOUCHSTART,j.EVT_TOUCHEND,j.EVT_TOUCHCANCEL],'tag:a',this._handleRootTouch.bind(this));if(q.id)p._instances[q.id]=this;}p.prototype.start=function(){"use strict";this.invoke('start');};p.prototype.setTypeObjects=function(q){"use strict";this._typeObjects=q;};p.prototype.setTypeObjectsOrder=function(q){"use strict";this._typeObjectsOrder=q;};p.prototype.setDatasource=function(q){"use strict";if(this._datasource){this._datasource.unbindFromTypeahead();this._waitingListener.remove();this._readyListener.remove();}this._waitingListener=q.listen('waiting',this.waitForResults.bind(this));this._readyListener=q.listen('resultsready',this.showResults.bind(this));q.bindToTypeahead(this);this._datasource=q;};p.prototype.getDatasource=function(){"use strict";return this._datasource;};p.prototype.getTypeaheadType=function(){"use strict";return 'm_legacy';};p.prototype.setInputNode=function(q){"use strict";this._control=q;return this;};p.prototype.hide=function(){"use strict";this._changeFocus(Number.NEGATIVE_INFINITY);this._display=[];if(this._root)i.hide(this._root);this.invoke('hide');};p.prototype.showResults=function(q){"use strict";this.invoke('render_start');var r={show:q},s=this.invoke('show',r);if(this._typeObjects&&this._typeObjectsOrder){var t={};for(var u=0;u<q.length;u++){var v=q[u].firstElementChild?q[u].firstElementChild.getAttribute('renderType'):null;if(!v)continue;if(!(v in t))t[v]=[];t[v].push(q[u]);}var w=[];for(var x in this._typeObjectsOrder){v=this._typeObjectsOrder[x];var y=t[v];if(y){var z=document.createElement('div');i.setContent(z,this._typeObjects[v].xhp);w.push(z.firstChild);w.push.apply(w,y);}}i.setContent(this._root,w);}else i.setContent(this._root,q);this._display=i.scry(this._root,'a','typeahead-result');if(this._display.length&&!s.getPrevented()){this._changeFocus(Number.NEGATIVE_INFINITY);var aa=l.getDim(this._hardpoint);aa.x=0;aa.setPos(this._root);if(this._root.parentNode!==this._hardpoint)this._hardpoint.appendChild(this._root);i.show(this._root);}else{this.hide();i.setContent(this._root,null);}this._refreshViewport();};p.prototype.refresh=function(){"use strict";this._refreshViewport();if(this._stop)return;this._value=this._control.value;this.invoke('update',this._value);this.invoke('change',this._value,this._control);};p.prototype.waitForResults=function(){"use strict";this.hide();};p.prototype._changeFocus=function(q){"use strict";var r=Math.min(Math.max(-1,this._focus+q),this._display.length-1);if(!this.getAllowNullSelection())r=Math.max(0,r);if(this._focus>=0&&this._focus<this._display.length)h.conditionClass(this._display[this._focus],'focused',false);this._focus=r;this._drawFocus();return true;};p.prototype._drawFocus=function(){"use strict";var q=this._display[this._focus];if(q)h.conditionClass(q,'focused',true);};p.prototype._choose=function(q){"use strict";var r=this.invoke('choose',q);if(r.getPrevented())return;this._control.value=q.name;this.hide();};p.prototype.clear=function(){"use strict";this._control.value='';this._value='';this.invoke('clear');this.hide();};p.prototype.enable=function(){"use strict";this._control.disabled=false;this._stop=false;};p.prototype.disable=function(){"use strict";this._control.blur();this._control.disabled=true;this._stop=true;};p.prototype.submit=function(){"use strict";if(this._focus>=0&&this._display[this._focus]){this._choose(this._display[this._focus]);return true;}else{var q=this.invoke('query',this._control.value);if(q.getPrevented())return true;}return false;};p.prototype.setValue=function(q){"use strict";this._control.value=q;};p.prototype.getValue=function(){"use strict";return this._control.value;};p.prototype._refreshViewport=function(){"use strict";var q=this._display&&this._display.length;if(q&&!this._heightConstraint){var r=l.getPos(this._root).y,s=l.getDim(this._root).y,t=k.getBoundingRect().height;if(r+s>t){var u=k.getHeaderHeight()+r+s;this._heightConstraint=k.addMinHeightConstraint(u);}}else if(this._heightConstraint&&!q){this._heightConstraint.release();this._heightConstraint=null;}this.invoke('rendered');};p.prototype._update=function(event){"use strict";var q=event&&event.getSpecialKey();if(q&&event.getType()=='keydown')switch(q){case 'up':if(this._display.length&&this._changeFocus(-1))event.prevent();break;case 'down':if(this._display.length&&this._changeFocus(1))event.prevent();break;case 'return':if(this.submit()){event.prevent();return;}break;case 'esc':if(this._display.length&&this.getAllowNullSelection()){this.hide();event.prevent();}break;case 'tab':return;}g(function(){if(this._value==this._control.value)return;this.refresh();}.bind(this),0);};p.prototype.handleEvent=function(q){"use strict";this.invoke(q.getType(),q);if(this._stop||q.getPrevented())return;var r=q.getType();if(r=='blur'){this._hasFocus=false;g(function(){if(!this._hasFocus)this.hide();}.bind(this),this.getBlurDefer());}else if(r=='focus'){this._hasFocus=true;}else this._update(q);};p.prototype.removeListener=function(){"use strict";if(this._listener)this._listener.remove();};p.prototype._handleRootTouch=function(q){"use strict";if(q.getType()===j.EVT_TOUCHSTART){this._rootTouchPos=j.getTouchPageCoord(q);this._rootTouchLink=q.getNode('tag:a')||undefined;var r=this._display[this._focus];if(r){h.conditionClass(r,'focused',false);this._focus=-1;}}else if(this._rootTouchPos){if(this._rootTouchLink===q.getNode('tag:a')){var s=j.getTouchPageCoord(q),t=this._rootTouchPos,u=3;if((Math.abs(s.x-t.x)<u)&&(Math.abs(s.y-t.y)<u))this._choose(this._rootTouchLink);}delete this._rootTouchLink;delete this._rootTouchPos;}if(q.getType()===j.EVT_TOUCHEND)q.prevent();};p.getInstance=function(q){"use strict";return p._instances[q];};o(p,['choose','query','start','change','show','focus','blur','keypressed','keypress','keydown','input','hide','clear','render_start','rendered','update','scroll']);n(p,{allowNullSelection:true,normalizer:null,blurDefer:0});m(p.prototype,{_root:null,_control:null,_hardpoint:null,_listener:null,_value:null,_stop:false,_focus:-1,_display:[],_hasFocus:false,_datasource:null,_waitingListener:null,_readyListener:null,_typeObjects:null,_typeObjectsOrder:null,_heightConstraint:null});m(p,{_instances:{}});e.exports=p;},null);
__d("MTokenizerWithExclusions",["MTokenizer","Stratcom"],function(a,b,c,d,e,f,g,h){for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(l,m){"use strict";g.call(this,l);var n=this.removeTokens.bind(this);h.listen('mtypeahead:exclusions',m,function(o){n(o.getData().ids);});}k.prototype.removeTokens=function(l){"use strict";for(var m=0;m<l.length;++m)this._remove(l[m]);};e.exports=k;},null);
__d("MTokenizerWithSuggestions",["setTimeoutAcrossTransitions","CSS","DOM","MTokenizer","copyProperties","createDeprecatedProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in j)if(j.hasOwnProperty(m))o[m]=j[m];var n=j===null?null:j.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=j;function o(p){"use strict";j.call(this,p);}o.prototype.start=function(){"use strict";j.prototype.start.call(this);h.conditionClass(this._containerNode,'suggestions',true);var p=i.scry(this._containerNode,'div','tokenizer-suggestions-label');if(p.length){this.setLabel(p[0]);i.remove(p[0]);}this.listen('removed',function(){g(this._typeahead.refresh.bind(this._typeahead),0);}.bind(this));};o.prototype.setTypeahead=function(p){"use strict";j.prototype.setTypeahead.call(this,p);p.setBlurDefer(o.blurDefer);p.listen('choose',function(q){g(function(){this._typeahead.refresh();}.bind(this),0);}.bind(this));p.listen('show',function(q){var r=q.show,s=[],t=o.maxSuggestions;for(var u=0;u<r.length;++u)if(!(r[u].rel in this._tokenMap)){s.push(r[u]);if(s.length>=t)break;}var v=this.getLabel();if(v&&v.length>0&&s.length&&p.getValue()==='')s.unshift(v);r.length=0;r.push.apply(r,s);}.bind(this));};o.prototype.shouldHideResultsOnChoose=function(){"use strict";return this.getFocused();};o.prototype.updateSuggestionsIds=function(p){"use strict";this._typeahead._datasource.setSuggestionsIds(p);this._typeahead.refresh();};o.prototype.handleEvent=function(p){"use strict";var q=p.getType();if(q=='focus'||q=='blur'){this.setFocused(q=='focus');g(function(){this._typeahead.refresh();}.bind(this),o.blurDefer);p.stop();}else j.prototype.handleEvent.call(this,p);};l(o,{focused:false,label:null});k(o,{maxSuggestions:50,blurDefer:500});e.exports=o;},null);
__d("MTypeaheadSourceWithExclusions",["MTypeaheadTouchSource","Stratcom"],function(a,b,c,d,e,f,g,h){for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(l,m,n){"use strict";g.call(this,l,m);var o=this.addExcludeID.bind(this);h.listen('mtypeahead:exclusions',n,function(p){var q=p.getData().ids;for(var r=0;r<q.length;++r)o(q[r]);});}k.prototype.sortHits=function(l,m){"use strict";for(var n=m.length-1;n>=0;--n)if(this._excludeIDs[m[n]])m.splice(n,1);g.prototype.sortHits.apply(this,arguments);};e.exports=k;},null);
__d("InitMTokenizer",["$","MTokenizer","MTokenizerWithExclusions","MTokenizerWithSuggestions","MTypeaheadOnDemandSource","MTypeaheadSourceWithExclusions","MTypeaheadTouchSource","MTypeaheadTouchSourceWithSuggestions","Stratcom","Typeahead","TypeaheadCompositeSource"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=function(s){var t=null,u=null,v=s.element;if(s.id)v=document.getElementById(s.id);if(s.suggestions.length){t=new n(s.src,s.source_key,s.suggestions);u=new j(v);}else{if(s.exclusions){u=new i(v,v.id);}else u=new h(v);if(t){u.setRemovableTokens(false);}else if(s.exclusions){t=new l(s.src,s.source_key,v.id);}else t=new m(s.src,s.source_key);}if(s.ondemand_src){var w=[t,new k(s.ondemand_src)];t=new q(w);}if(s.excludeids)s.excludeids.forEach(function(aa){t.addExcludeID(aa);});if(s.maxresults)t.setMaximumResultCount(s.maxresults);if(t instanceof m||t instanceof k)t.setShowSecondaryAction(false);var x=s.textinput;if(typeof x==='string')x=g(x);var y=new p(v,x);y.setDatasource(t);y.setTypeObjects(s.typeObjects);y.setTypeObjectsOrder(s.typeObjectsOrder);u.setTypeahead(y);u.setInitialValue(s.initialtokens);u.setLabel(s.label);u.setPlaceholder(s.placeholder);u.setLimitWidth(s.limitwidth);if(s.limit)u.setLimit(s.limit);if(s.freeform){var z=new RegExp(s.freeform,'i');y.listen('change',function(aa){if(z&&z.test(aa)){t.lastChange=Date.now();var ba={uri:'#',name:aa,id:aa,display:aa},ca=[t.createNode(ba)];y.showResults(ca);o.context().kill();}});}if(s.needs_template_data&&Object.keys(s.initialtokens).length>0)y.disable();u.start();};f.main=r;},null);
__d("MTokenizerBehavior",["CSS","Stratcom","MViewport","Vector"],function(a,b,c,d,e,f,g,h,i,j){var k=false,l={addListener:function(m){if(k)return;k=true;h.listen('click',[['tokenizer','typeahead-result'],['remove']],function(n){n.prevent();});h.listen(['focus','blur'],'tokenizer-input',function(n){var o=n.getNode('tokenizer'),p=n.getType()=='blur';g.conditionClass(o,'blurred',p);if(p){if(m.clearvalueonblur||1)o.tokenizer&&o.tokenizer.getTypeahead().clear();}else if(m.shouldscroll)i.scrollTo(0,j.getPos(o).y);});}};e.exports=l;},null);