/*!CK:3901210102!*//*1415719836,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["gZk1X"]); }

__d("MStickerPack.react",["MRequest","MURI","MStickersInitialData","React","XStickerPackImagesControllerURIBuilder","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=i.MRU_STICKER_PACK,o={},p=j.createClass({displayName:"MStickerPack",getInitialState:function(){return {loading:false,stickers:[]};},getDefaultProps:function(){return {isComments:false};},componentWillMount:function(){this.getStickers(this.props.pack.id);},componentWillReceiveProps:function(q){this.getStickers(q.pack.id);},updateRecentlyUsed:function(q){var r=o[this.props.pack.id].filter(function(u){return u.id===q;})[0],s=o[n]||[];for(var t=0;t<s.length;++t)if(s[t].id===q){s.splice(t,1);break;}s.unshift(r);if(!o[n]){o[n]=s;i.packs.unshift(i.mru);}},getStickers:function(q){if(!q)return;if(q in o){this.setState({loading:false,stickers:o[q]});return;}var r=new k().setInt('pack_id',q).getURI(),s=new g(new h(r).setAsync(true));s.listen('done',function(t){o[q]=t.payload;this.isMounted()&&this.setState({loading:false,stickers:t.payload});}.bind(this));this.setState({loading:true});s.send();},selectSticker:function(q){this.updateRecentlyUsed(q);this.props.onSelect&&this.props.onSelect(q);},renderSticker:function(q){var r=null;if(this.props.isComments&&q.isMessengerOnly){if(this.props.pack.id==i.MRU_STICKER_PACK)return;}else r=this.selectSticker.bind(this,q.id);return (j.createElement("div",{className:"_5asg",onClick:r},j.createElement("img",{src:q.uri})));},render:function(){if(this.state.loading)return (j.createElement("div",{className:"_5ash"},j.createElement("span",{className:"_5asi"},"\u6b63\u5728\u52a0\u8f7d...")));var q=this.state.stickers.map(function(s){return this.renderSticker(s);}.bind(this)),r=this.props.isComments&&this.props.pack.isMessengerOnly;return (j.createElement("div",{className:(("_5ash")+(r?' '+"_5jkg":'')),onScroll:this.props.onScroll},j.createElement("div",{className:"_5ef_"},q),this.renderMask()));},renderMask:function(){if(!this.props.isComments||!this.props.pack.isMessengerOnly)return null;return (j.createElement("div",{className:"_5jkh"},j.createElement("div",{className:"_5jki"},"\u6b64\u8d34\u56fe\u5305\u4ec5\u9650\u5728\u6d88\u606f\u4e2d\u4f7f\u7528")));}});e.exports=p;},null);
__d("MStickerSelector.react",["BanzaiLogger","Image.react","MPageController","MStickerPack.react","MStickersInitialData","MViewport","React","XStickerStorePermalinkControllerURIBuilder","cx","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=m.createClass({displayName:"MStickerSelector",propTypes:{callback:m.PropTypes.func.isRequired,isComments:m.PropTypes.bool.isRequired,isOpen:m.PropTypes.bool,onClose:m.PropTypes.func,showStore:m.PropTypes.bool.isRequired},getInitialState:function(){var s=k.packs&&k.packs.length?k.packs[0]:null;return {selectedPack:s};},getDefaultProps:function(){return {isComments:true,showStore:true};},onStickerSelect:function(s){this.props.callback&&this.props.callback(s);},onPackSelect:function(s){g.log('MTouchStickersLoggerConfig',{event:'select_pack',packid:s.id});this.setState({selectedPack:s});},onPackScroll:function(){if(this.state.selectedPack&&this.state.selectedPack.id!=this._lastScrolledPackID){this._lastScrolledPackID=this.state.selectedPack.id;g.log('MTouchStickersLoggerConfig',{event:'scroll_pack',packid:this.state.selectedPack.id});}},renderPack:function(s){var t=(s.id==this.state.selectedPack.id),u=this.props.isComments&&s.isMessengerOnly,v=(("_5arz")+(' '+"_5cni")+(t?' '+"_5ar-":'')+(u?' '+"_4f39":'')),w=s.icon;if(s.id==k.MRU_STICKER_PACK)w=t?q('/images/mobile/messages/stickers/time_active.png'):q('/images/mobile/messages/stickers/time.png');return (m.createElement("a",{rel:"ignore",className:v,onClick:this.onPackSelect.bind(this,s)},m.createElement(h,{src:w,alt:s.name})));},renderIndicator:function(){if(!k.storeIndicator)return null;return m.createElement("div",{className:"_5e-s"});},renderSelector:function(){if(!this.props.isOpen)return null;var s=(k.packs.length===0)?m.createElement("div",{className:"_5ar_"},"\u6ca1\u6709\u53ef\u7528\u8d34\u56fe"):m.createElement(j,{pack:this.state.selectedPack,onSelect:this.onStickerSelect,onScroll:this.onPackScroll,isComments:this.props.isComments}),t=k.packs;if(this.props.isComments){var u=[],v=[];for(var w=0;w<t.length;w++)if(t[w].isMessengerOnly){v.push(t[w]);}else u.push(t[w]);t=u.concat(v);}t=t.map(this.renderPack,this);var x=(new n()).setString('redirect_uri',i.getRenderedPath()).setBool('is_messenger',!this.props.isComments).getURI(),y=null;if(this.props.showStore)y=m.createElement("a",{className:"_5cni _5b3_",href:x.toString()},m.createElement("span",{className:"_5b40"}),this.renderIndicator());return (m.createElement("div",{ref:"selector",className:"_5as0"},m.createElement("div",{className:"_5as1"},s),m.createElement("div",{className:"_5as2"},m.createElement("a",{rel:"ignore",className:"_5cni _g-8",href:"#",onClick:this.props.onClose},m.createElement("span",{className:"_5b3-"})),m.createElement("div",{className:"_5as5"},t)),y));},render:function(){return (m.createElement("div",null,this.renderSelector()));},componentDidUpdate:function(s,t){if(this.props.isOpen){l.scrollToNode(this.refs.selector.getDOMNode());if(this.props.isOpen!=s.isOpen)g.log('MTouchStickersLoggerConfig',{event:'open_tray'});}}});e.exports=r;},null);
__d("MStickerSelectorButton.react",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:"MStickerSelectorButton",propTypes:{onToggle:g.PropTypes.func,isSelected:g.PropTypes.bool},getDefaultProps:function(){return {isSelected:false};},getInitialState:function(){return {isSelected:this.props.isSelected};},componentWillUpdate:function(j,k){if(j!==this.props)this.setState({isSelected:j.isSelected});if(this.props.onToggle&&k!==this.state)this.props.onToggle(k.isSelected);},onClick:function(event){this.setState({isSelected:!this.state.isSelected});},render:function(){return (g.createElement("button",{type:"button",className:(("_5ecn")+(' '+"_1n29")+(this.state.isSelected?' '+"_5ar-":'')),onClick:this.onClick},g.createElement("div",{className:"_5as6"})));}});e.exports=i;},null);
__d("MStickerMount",["DOM","MRequest","MStickerSelector.react","MStickerSelectorButton.react","React","Stratcom","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=function(p,q,r,s,t,u){k.initializeTouchEvents(true);var v,w=k.render(k.createElement(i,{callback:s,isComments:t,onClose:function(){w&&w.setProps({isOpen:false});v&&v.setProps({isSelected:false});},showStore:u}),q);v=k.render(k.createElement(j,{onToggle:function(y){w.setProps({isOpen:y});}}),p);var x=g.listen(r,'focus',null,function(){v.setProps({isSelected:false});});l.listen('m:page:unload',null,function(){l.removeCurrentListener();x&&x.remove();});},o={initMessages:function(p,q,r,s){var t=m(r),u=function(v){var w=t.form,x=g.convertFormToDictionary(w);x.sticker_id=v;s.sendRequest(w.action,x);};n(m(p),m(q),t,u,false,true);},initComments:function(p,q,r){var s=m(r),t=function(u){var v=s.form,w=g.convertFormToDictionary(v);w.sticker_id=u;var x=new h(v.action);x.addData(w);x.setMethod('POST');x.send();};n(m(p),m(q),s,t,true,true);},initNewMessage:function(p,q,r,s){var t=function(u){s.sendSticker(u);};n(p,q,r,t,false,false);}};e.exports=o;},null);
__d("MPhotoStage",["setTimeoutAcrossTransitions","CSS","cx","DOM","Stratcom","Vector","DataStore","MURI","MRequest","MViewport","MInputFocus","MJSEnvironment","prefetchImage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=false,u='photo-stage',v='photo-image',w='facebox',x='new-tag-placeholder',y='photos-input-tag',z='photo-tag-loading',aa='popup-nub',ba='tokenizer-input',ca='transfer-focus-container',da=2000,ea=200,fa=null,ga=null,ha=null,ia=null;function ja(ra,sa,ta){var ua=0,va=p.getUseableWidth();if(ta>va){ua=ta-va;}else if(sa<0)ua=sa;if(ua===0)return ra;return new l(ra.x-ua,ra.y);}function ka(ra){if(!ra)return;h.conditionClass(ra,"_57-n",!!ha);if(ha){clearTimeout(ha);ha=null;}else ha=g(function(){ka(ra);},da);}function la(){fa=null;while(ia.length)(ia.pop()).remove();t=false;}function ma(ra){var sa=l.getPos(ra),ta=l.getDim(ra),ua=l.getPos(fa),va=new l(sa.x+ta.x/2,sa.y+ta.x-ua.y),wa=j.find(fa,'*',z);va.setPos(wa);j.show(wa);}function na(ra,sa,ta){var ua=new n(ra.write_tag_uri);ua.addQueryData('id',ra.owner_id);ua.addQueryData('facebox_id',sa.facebox_id);ua.addQueryData('replace_id',x);ua.addQueryData('sd_source',ra.source);ua.addQueryData('sd_set',ra.set);var va={};va['ids['+ta+']']=ta;va['x['+ta+']']=sa.facebox_center.x;va['y['+ta+']']=sa.facebox_center.y;var wa=(new o(ua.normalize().setAsync(true).toString())).addData(va);return wa;}function oa(ra,sa){ga=ra;var ta=j.find(fa,'*',y),ua=l.getPos(fa),va=l.getPos(ra),wa=l.getDim(ra),xa=new l(va.x+wa.x/2,va.y+wa.y-ua.y),ya=ja(xa,xa.x-ea/2,xa.x+ea/2),za=j.find(ta,'*',aa);za.style.left=(xa.x-ya.x)+"px";var ab=m.get(ga);if(ab.suggestions)sa.tokenizer.updateSuggestionsIds(ab.suggestions);ya.setPos(ta);j.show(ta);var bb=j.find(ta,'*',ba);bb.focus();q.scrollTo(bb,va.y);if(ha){clearTimeout(ha);ha=null;}}function pa(ra){var sa=j.find(fa,'*',y);if(ga){var ta=m.get(ga),ua=m.get(fa),va=na(ua,ta,ra);ma(ga);va.listen('finally',function(){var wa=j.find(fa,'*',z);j.hide(wa);ka(fa);});va.send();j.hide(ga);j.hide(sa);j.find(sa,'*',ba).blur();ga=null;}ha=g(function(){ka(fa);},da);}var qa=function(ra,sa){if(t)return;fa=ra;t=true;var ta='touchend';if(r.IS_ANDROID)ta='click';if(sa&&sa.use_faceboxes){ia=[k.listen(ta,u,function(event){if(ga){var va=j.find(fa,'*',y);j.find(va,'*',ba).blur();j.hide(va);ga=null;event.kill();}else ka(event.getNode(u));}),k.listen(ta,w,function(event){var va=j.find(fa,'*',ca),wa=event.getNode(w);oa(wa,va);event.kill();}),k.listen(ta,ca,function(event){var va=event.getNode(ca),wa=j.find(va,'*',ba);wa.focus();if(ga)q.scrollTo(wa,l.getPos(ga).y);event.kill();}),k.listen('Tokenizer-addedtoken',null,function(event){pa(event.getData().rel);})];}else ia=[k.listen('touchend',u,function(event){ka(event.getNode(u));})];ia.push(k.listen('m:page:unload',null,la));var ua=j.scry(fa,'*',v);if(ua.length>0&&m.get(ua[0]).imgsrc){s(m.get(ua[0]).imgsrc,function(){return ka(fa);});}else ka(fa);};f.main=qa;},null);
__d("MTouchAfro",["$","CSS","cx","DataStore","DOM","fbt","ge","MModalDialog","MRequest","MXUIDiv.react","Parent","React","Stratcom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=false,u={initUndoHide:function(){if(t)return;var v=s.listen('click','afro-undo-hide',function(w){var x=w.getNode('undo-content'),y=j.get(x).storyDomID;k.hide(x);k.show(g(y));});t=true;s.listen('m:page:unload',null,function(){v.remove();s.removeCurrentListener();t=false;});},hideOriginalContent:function(v){k.hide(g(v));},initDoneListener:function(v,w){var x=s.listen('click','afro-dialog-done',function(y){if(v){var z=g(v);if(z){var aa=j.get(z).enhancedAfro;if(aa)h.addClass(z,"_2gft");}r.render(r.createElement(p,{padding:"large",fontshade:"medium",fontweight:"bold"},"\u611f\u8c22\u4f60\u5411\u6211\u4eec\u53cd\u6620\u60c5\u51b5\u3002"),g(v));if(w){var ba=m(w);if(ba){k.remove(ba);h.removeClass(q.byClass(g(v),"_2b01"),"_2b01");}}}n.close();});s.listen('m:page:unload',null,function(){x.remove();s.removeCurrentListener();});},showConfirmationPopup:function(v,w){var x=confirm(v);if(x){var y=new o(w);y.send();}},showInlineConfirmation:function(v,w){var x=g(v);k.hide(x);k.insertAfter(x,w);},redirect:function(v,w){if(!w){window.location=v;}else{var x=new o(v);x.send();}},optionCheckOnClick:function(){var v=s.listen('mousedown','nfx-option-select',function(x){var y=x.getNode('nfx-option-select');if(!y)return;var z=y.getElementsByClassName("_13qc")[0];if(!z)return;h.addClass(z,'active');h.addClass(y,"_59e9");}),w=s.listen('mouseup','nfx-option-select',function(x){var y=x.getNode('nfx-option-select');if(!y)return;var z=y.getElementsByClassName("_13qc")[0];if(!z)return;h.removeClass(z,'active');z.setAttribute('checked',true);});s.listen('m:page:unload',null,function(){v.remove();w.remove();s.removeCurrentListener();});},openDialogOnClick:function(v,w){var x=s.listen('click',w,function(y){n.open(v);});s.listen('m:page:unload',null,function(){x.remove();s.removeCurrentListener();});}};e.exports=u;},null);
__d("MComposer",["MMultiPhotoUploaderAttachmentState","CSS","DOM","DataStore","MParent","MViewport","cancelAnimationFrame","cx","getActiveElement","requestAnimationFrame","setTimeoutAcrossTransitions","Stratcom","StratcomManager","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u,v,w,x=function(y){if(y!==null&&y.should_focus&&y.composer_id)q(function(){t(y.composer_id).focus();},0);r.invoke('marauder-fb-composer-init',null,{parent_fbid:y?y.target_id:-1});v=y.toggle_submit;if(u)return;u=true;function z(da){if(da.tagName==='FORM'){return da;}else return i.find(da,'form');}r.listen('focus',['m-composer','textarea'],function(event){var da=event.getNode('m-composer'),ea=i.find(da,'*','textarea');ca(da);if(!j.get(da).disable_auto_scroll)l.scrollToNode(ea);});r.listen('focus',['m-composer','privacy-selector'],function(event){h.removeClass(event.getNode('m-composer'),'composerClosed');});r.listen('keyup','textarea',function(event){var da=event.getNode('textarea');r.invoke('marauder-feedback-input',null,{draft:da.value});ba(event.getNode('m-composer'));});r.listen('paste',['m-composer','textarea'],function(event){ba(event.getNode('m-composer'));});var aa=g.getDefaultState();r.listen('MMultiPhotoUploader:attachments:change',null,function(event){var da=t(event.getData().input_id);if(!da)return;aa=event.getData();var ea=k.bySigil(da,'m-photo-composer');if(!ea)return;var fa=i.find(ea,'*','m-composer');ba(fa);ca(fa);});function ba(da){if(!v||!da)return;if(w)m(w);w=p(function(){w=null;var ea=i.find(da,'*','composer-submit'),fa=aa[g.SENDING]===0&&(!/^\s*$/.test(i.find(da,'*','textarea').value)||aa[g.UPLOADED]>0);if(!fa){ea.setAttribute('disabled',true);}else ea.removeAttribute('disabled');h.conditionClass(ea,"_56bt",!fa);h.conditionClass(ea,"_56bu",fa);});}function ca(da){if(!da||!j.get(da).auto_collapse||!j.get(z(da)).expand_composer)return;var ea=i.find(da,'*','textarea'),fa=o()===ea||!/^\s*$/.test(ea.value)||aa[g.UPLOADED]>0;h.conditionClass(da,'composerClosed',!fa);}s.enableDispatch(window,'reset');r.listen('blur',['m-composer','textarea'],function(event){ca(event.getNode('m-composer'));});r.listen('reset',['m-composer'],function(event){var da=event.getNode('m-composer');ba(da);ca(da);});r.listen('touchend',['m-composer','composer-submit'],function(event){var da=event.getNode('composer-submit'),ea=j.get(da);if(!ea.onclickIsSet){var fa=event.getNode('m-composer'),ga=i.find(fa,'*','textarea');da.onclick=function(){ga.blur();};ea.onclickIsSet=true;}});r.listen('click','composer-submit',function(event){r.invoke('marauder-feedback-posted',null,{});});r.listen('click','m-add-comment',function(event){var da=event.getNode('m-ufi'),ea=i.find(da,'*','m-composer'),fa=i.find(ea,'*','textarea');fa.focus();});};f.main=x;},null);
__d("MFeedbackCommentFocus",["DOM","Stratcom"],function(a,b,c,d,e,f,g,h){var i=false,j=function(){if(i)return;i=true;h.listen('click',['m-feedback-comment-link'],function(event){var k=event.getTarget(),l='async_composer',m='textarea',n=new RegExp('\\b'+l+'\\b');while(k&&k.className!==undefined&&!k.className.match(n))k=k.parentNode;k=k||document.body;var o=g.scry(k,'*',m)[0];if(o){o.focus();event.prevent();}});};f.main=j;},null);
__d("MImagePreloader",[],function(a,b,c,d,e,f){function g(h){for(var i=0;i<h.length;i++){var j=new Image();j.src=h[i];}}f.init=g;},null);